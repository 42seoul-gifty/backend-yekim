<!DOCTYPE html>
<meta charset="UTF-8">
<head>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>
    <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>

    <style>
    </style>
</head>
<body class="container">

<div class="row">
    <div class="col-3"> <%- include ('./nav') -%> </div>
    <div class="col-9" style="padding-top: 30px;">
        <div class="input-group mb-3">
            <select id="product_category" class="form-select" aria-label="Default select example">
                <option selected>카테고리</option>
                <option value="화장품">화장품</option>
                <option value="식품">식품</option>
                <option value="건강">건강</option>
                <option value="리빙">리빙</option>
                <option value="패션잡화">패션잡화</option>
                <option value="디지털">디지털</option>
            </select>
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">상품코드</span>
            <input id="product_code" type="text" class="form-control" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">상품명</span>
            <input id="product_name" type="text" class="form-control" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">썸네일</span>
            <input id="product_thumbnail" name="thumbnail" type="file" class="form-control" aria-describedby="basic-addon1" accept="image/*">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">이미지</span>
            <input id="product_images" name="images" type="file" class="form-control" aria-describedby="basic-addon1" accept="image/*" multiple="multiple">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">판매처</span>
            <input id="product_brand" type="text" class="form-control" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">소비자가</span>
            <input id="product_retail_price" type='number' class="form-control" aria-describedby="basic-addon1" placeholder=",를 떼고 숫자만 입력해주세요">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">수수료율</span>
            <input id="product_fee_rate"  type='number' class="form-control" aria-describedby="basic-addon1" placeholder=",를 떼고 숫자만 입력해주세요">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">제품링크</span>
            <input id="product_link" type="text" class="form-control" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">상품소개</span>
            <input id="product_description" class="form-control" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">상품정보제공고시</span>
            <textarea id="product_detail" class="form-control" rows="16"></textarea>
        </div>
        <div class="input-group mb-3  register">
            <select id="product_gender" class="form-select multiple">
                <option selected>전체</option>
                <option value="남성">남성</option>
                <option value="여성">여성</option>
            </select>
        </div>
        <div class="input-group mb-3 register">
            <select id="product_age" class="form-select">
                <option selected>연령대</option>
                <option value="20~24세">20~24세</option>
                <option value="25~29세">25~29세</option>
                <option value="30~34세">30~34세</option>
                <option value="35~39세">35~39세</option>
                <option value="40~44세">40~44세</option>
                <option value="45세 이상">45세 이상</option>
            </select>
        </div>
        <div>
            <select id="product_price" class="form-select" aria-label="Default select example">
                <option selected>가격대</option>
                <option value="1만 5천원">1만 5천원</option>
                <option value="2만원">2만원</option>
                <option value="2만 5천원">2만 5천원</option>
                <option value="3만원">3만원</option>
                <option value="3만 5천원">3만 5천원</option>
                <option value="4만원">4만원</option>
                <option value="4만 5천원">4만 5천원</option>
                <option value="5만원">5만원</option>
            </select>
        </div>
        <br>
        <br>
        <button id="register" type="button" class="btn btn-primary" style="width: 200px; height:50px; margin: 0 40%;">
            저장
        </button>
        <br>
        <br>
        <br>
    </div>
</div>
</body>

<script>
    (function($) {
        $(function() {
            $('#register').click(save);
        });

        async function save() {
            if ($('#product_category').val() === "카테고리") {
                alert("카테고리를 입력해주세요.");
            } else if ($('#product_code').val() === "") {
                alert("상품코드를 입력해주세요.");
            } else if ($('#product_name').val() === "") {
                alert("상품명을 입력해주세요.");
            } else if ($('#product_brand').val() === "") {
                alert("판매처를 입력해주세요.");
            } else if ($('#product_retail_price').val() === "") {
                alert("소비자가를 입력해주세요.");
            } else if ($('#product_fee_rate').val() === "") {
                alert("수수로율을 입력해주세요.");
            } else if ($('#product_link').val() === "") {
                alert("링크를 입력해주세요.");
            } else if ($('#product_age').val() === "연령대") {
                alert("연령대를 선택해주세요.");
            } else if ($('#product_price').val() === "가격대") {
                alert("가격대를 선택해주세요.");
            }

            const formData = new FormData();
            formData.append('category', $('#product_category').val());
            formData.append('code', $('#product_code').val());
            formData.append('name', $('#product_name').val());
            formData.append('thumbnail', document.getElementById('product_thumbnail').files[0]);
            const images = document.getElementById('product_images').files;
            console.log(images);
            for (let i = 0; i < images.length; ++i) {
                formData.append('images', images[i]);
            }
            formData.append('brand', $('#product_brand').val());
            formData.append('retail_price', $('#product_retail_price').val());
            formData.append('fee_rate', $('#product_fee_rate').val());
            formData.append('link', $('#product_link').val());
            formData.append('description', $('#product_description').val());
            const detail = $('#product_detail').val().replace(/\n/gi, '<br>');
            formData.append('detail', detail);
            formData.append('gender', $('#product_gender').val());
            formData.append('age', $('#product_age').val());
            formData.append('price', $('#product_price').val());

            for (let value of formData.values()) {
                console.log(value);
            }

            try {
                await axios.post('http://localhost:4242/admin/product/register', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data; charset=utf-8'
                    }
                });
                alert("새로운 상품이 등록되었습니다.");
            } catch (err) {
                console.log("form data 전송 실패", err);
            }
        }
    })(jQuery);
</script>
</html>

