<meta charset="UTF-8">
<head>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.min.js"></script>-->
    <!--    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>-->
    <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-3">
            <%- include ('nav') -%>
        </div>
        <div class="col-9">
            <div id="content">
                <table id="select">
                    <tr>
                    <tr>
                        <td class="manage">
                            <select id="year" class="manage form-select">
                                <option value="전체">전체</option>
                                <option value="1">2021</option>
                                <option value="2">2022</option>
                                <option value="3">2023</option>
                            </select>
                        </td>
                        <td class="manage">
                            <select id="month" class="manage form-select">
                                <option value="전체">전체</option>
                                <option value="1">1월</option>
                                <option value="2">2월</option>
                                <option value="3">3월</option>
                                <option value="4">4월</option>
                                <option value="5">5월</option>
                                <option value="6">6월</option>
                                <option value="7">7월</option>
                                <option value="8">8월</option>
                                <option value="9">9월</option>
                                <option value="10">10월</option>
                                <option value="11">11월</option>
                                <option value="12">12월</option>
                            </select>
                        </td>
                        <td class="manage">
                            <select id="day_range" class="manage form-select">
                                <option value="전체">전체</option>
                                <option value="1">10일 이전</option>
                                <option value="2">11~20일</option>
                                <option value="3">21일 이후</option>
                            </select>
                        </td>
                        <td>
                            <button type="button" class="btn btn-primary">filter</button>
                        </td>
                        <td>
                            <div style="margin-left: 30px;" id="pagination"></div>
                        </td>
                    </tr>
                </table>

                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th scope="col">No</th>
                        <th scope="col">성별</th>
                        <th scope="col">연령대</th>
                        <th scope="col">가격대</th>
                        <th scope="col">연락처</th>
                        <th scope="col">주소</th>
                        <th scope="col">상세주소</th>
                        <th scope="col" style="width: 200px;">선택 상품</th>
                        <th scope="col">배송상태</th>
                    </tr>
                    </thead>
                    <tbody id="order_list">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    (function ($) {
        $(async function () {
            let filter = {
                year: '전체',
                month: '전체',
                day_range: '전체',
            }

            function showOrders(orders) {
                $('#order_list').empty();
                $.each(orders, function (index, item) {
                    const orderRow = makeOrderRow(item);
                    $('#order_list').append(orderRow);
                })
            }

            let orders = await getOrdersFromServer(filter);
            orders = setOrdersInfo(orders.data);
            showOrders(orders);

            $(".btn, .btn-primary").css({ marginLeft: "5px", height: "40px" })
                .click(async function() {
                    const filter = {
                        year: $('#year').val(),
                        month: $('#month').val(),
                        day_range: $('#day_range').val(),
                    };
                    let orders = await getOrdersFromServer(filter);
                    orders = setOrdersInfo(orders.data);
                    showOrders(orders);
                });
        });
    })(jQuery);

    function setOrdersInfo(orders) {
        return orders;
    }

    async function getOrdersFromServer(filter) {
        try {
            const ret = await axios.post('/admin/order/filter', {
                filter: filter
            }, {
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            console.log(ret);
            return ret;
        } catch (err) {
            console.log("상품 데이터 조회 오류:", err);
            return undefined;
        }
    }

    function makeOrderRow(order) {
        let orderRow = '<tr>';
        orderRow += `<td scope="col"><p>${order.id}</p></td>`;
        orderRow += `<td scope="col"><p>${order.gender}</p></td>`;
        orderRow += `<td scope="col"><p>${order.age}</p></td>`;
        orderRow += `<td scope="col"><p>${order.price}</p></td>`;
        orderRow += `<td scope="col"><p>${order.phone}</p></td>`;
        orderRow += `<td scope="col"><p>${order.address}</p></td>`;
        orderRow += `<td scope="col"><p>${order.detailAddress}</p></td>`;
        orderRow += `<td scope="col"><p>${order.productName}</p></td>`;
        orderRow += `<td scope="col"><button type="button" class="btn btn-light"><p>삭제</button></p></td>`;
        orderRow += '</tr>'
        return orderRow;
    }

    function filter() {
    }
</script>
</body>
</html>