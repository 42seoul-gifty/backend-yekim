<!DOCTYPE html>
<html>
<head>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <title><%= title %></title>
</head>
<body>
    <h1><%= title %></h1>
    <div class="input-group">
        <% if (code !== undefined) { %>
            <p> <%= code %> </p>
        <% } else { %>
            <a id="auth-code" href="/auth" class="btn">인가코드 받기</a>
            <br>
        <% } %>
    </div>
    <div class="input-group">
       <input id="auth_code" type="text" class="form-control" aria-describedby="basic-addon1">
       <button id="register" type="button" class="btn btn-primary" onclick="getTokensFromServer()" style="width: 200px; height:50px; margin: 0 40%;">
           토큰발급
       </button>
    </div>
    <br>
    <br>
    <div class="input-group">
        <input id="access_token" type="text" class="form-control" aria-describedby="basic-addon1">
        <button id="register" type="button" class="btn btn-primary" onclick="setTokensOnHeaders()" style="width: 200px; height:50px; margin: 0 40%;">
            프로필 페이지
        </button>
    </div>
    <div class="input-group">
        <input id="refresh_token" type="text" class="form-control" aria-describedby="basic-addon1">
        <button id="register" type="button" class="btn btn-primary" onclick="renewToken()" style="width: 200px; height:50px; margin: 0 40%;">
            토큰갱신
        </button>
    </div>
    <div>
        <button id="register" type="button" class="btn btn-primary" onclick="logout()" style="width: 200px; height:50px; margin: 0 40%;">
            로그아웃
        </button>
    </div>
    <a href="/" style="width: 200px; height:50px; margin: 0 40%;">
        홈으로
    </a>
    <!--    <form id="profile" action="/profile" method="get">-->
<!--        <button id="profile" type="submit" class="btn">프로필보기</button>-->
<!--    </form>-->
<!--    <form id="logout" action="/auth/logout" method="post">-->
<!--        <button id="logout" type="submit" class="btn">로그아웃</button>-->
<!--    </form>-->
</body>
<script>
    const hostAddr = 'http://localhost:4242'
    function getTokensFromServer() {
        const authCode = document.getElementById('auth_code').value;
        console.log("authCode:", authCode);
        axios.get(`${hostAddr}/login/kakao`, {
            headers: {
                'Authorization-Code': authCode
            }
        })
            .then(function(response){
                console.log(response.data);
                console.log(response.data.data.access_token);
                console.log(response.data.data.refresh_token);
            })
            .catch(function(error){
                console.log(error);
            })
    }

    function setTokensOnHeaders() {
        const accessToken = document.getElementById('access_token').value;
        // const refreshToken = document.getElementById('refresh_token').value;
        axios.get(`${hostAddr}/profile`, {
            headers: {
                'Authorization': `Bearer ${accessToken}`,
            }
        })
            .then(function(response){
                console.log(response.data);
            })
            .catch(function(error){
                console.log(error);
            })
    }

    function renewToken() {
        const refreshToken = document.getElementById('refresh_token').value;
        // const refreshToken = document.getElementById('refresh_token').value;
        axios.get(`${hostAddr}/token/refresh`, {
            headers: {
                'Authorization': `Bearer ${refreshToken}`,
            }
        })
            .then(function(response){
                console.log(response.data);
            })
            .catch(function(error){
                console.log(error);
            })
    }

    function logout() {
        const accessToken = document.getElementById('access_token').value;
        const refreshToken = document.getElementById('refresh_token').value;
        axios.post(`${hostAddr}/logout`, {
            "refresh_token": refreshToken,
        },{
            headers: {
                'access_token': accessToken,
                "refresh_token": refreshToken,
            }
        })
            .then(function(response){
                console.log(response.data);
            })
            .catch(function(error){
                console.log(error);
            })
    }
</script>
</html>